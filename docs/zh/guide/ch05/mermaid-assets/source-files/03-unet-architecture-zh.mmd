%% Title: U-Net架构深度解析
%% Description: 展示U-Net的编码器-解码器结构和跳跃连接
%% File: 03-unet-architecture-zh.mmd

graph TD
    subgraph "编码器路径（收缩路径）<br><i>Encoder Path (Contracting Path)</i>"
        A["<b>输入: 512×512×1</b><br><i>Input</i>"] --> B["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        B --> C["<b>64个通道</b><br><i>64 channels</i>"]
        C --> D["<font color='#e74c3c'>MaxPool2×2</font>"]
        D --> E["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        E --> F["<b>128个通道</b><br><i>128 channels</i>"]
        F --> G["<font color='#e74c3c'>MaxPool2×2</font>"]
        G --> H["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        H --> I["<b>256个通道</b><br><i>256 channels</i>"]
        I --> J["<font color='#e74c3c'>MaxPool2×2</font>"]
        J --> K["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        K --> L["<b>512个通道</b><br><i>512 channels</i>"]
        L --> M["<font color='#e74c3c'>MaxPool2×2</font>"]
        M --> N["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        N --> O["<b>1024个通道</b><br><i>1024 channels</i>"]
    end

    subgraph "解码器路径（扩展路径）<br><i>Decoder Path (Expanding Path)</i>"
        O --> P["<font color='#27ae60'>上卷积2×2</font><br><i>Up-Conv2×2</i>"]
        L --> P
        P --> Q["<b>拼接: 1024+512=1536</b><br><i>Concat</i>"]
        Q --> R["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        R --> S["<b>512个通道</b><br><i>512 channels</i>"]
        S --> T["<font color='#27ae60'>上卷积2×2</font><br><i>Up-Conv2×2</i>"]
        I --> T
        T --> U["<b>拼接: 512+256=768</b><br><i>Concat</i>"]
        U --> V["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        V --> W["<b>256个通道</b><br><i>256 channels</i>"]
        W --> X["<font color='#27ae60'>上卷积2×2</font><br><i>Up-Conv2×2</i>"]
        F --> X
        X --> Y["<b>拼接: 256+128=384</b><br><i>Concat</i>"]
        Y --> Z["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        Z --> AA["<b>128个通道</b><br><i>128 channels</i>"]
        AA --> AB["<font color='#27ae60'>上卷积2×2</font><br><i>Up-Conv2×2</i>"]
        C --> AB
        AB --> AC["<b>拼接: 128+64=192</b><br><i>Concat</i>"]
        AC --> AD["<font color='#3498db'>Conv3×3+ReLU ×2</font>"]
        AD --> AE["<b>64个通道</b><br><i>64 channels</i>"]
        AE --> AF["<font color='#9b59b6'>Conv1×1</font>"]
        AF --> AG["<b>输出: 分割图</b><br><i>Output: Segmentation Map</i>"]
    end

    %% Styling
    style A fill:#e8f5e8,stroke:#27ae60,stroke-width:3px,color:#2c3e50
    style AG fill:#fadbd8,stroke:#e74c3c,stroke-width:3px,color:#2c3e50

    %% Skip connections styling
    classDef skip fill:#f9f,stroke:#333,stroke-width:2px,color:#2c3e50;

    %% Style nodes
    style B fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style C fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style D fill:#fadbd8,stroke:#e74c3c,stroke-width:2px,color:#2c3e50
    style E fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style F fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style G fill:#fadbd8,stroke:#e74c3c,stroke-width:2px,color:#2c3e50
    style H fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style I fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style J fill:#fadbd8,stroke:#e74c3c,stroke-width:2px,color:#2c3e50
    style K fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style L fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style M fill:#fadbd8,stroke:#e74c3c,stroke-width:2px,color:#2c3e50
    style N fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style O fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50

    style P fill:#d5f4e6,stroke:#27ae60,stroke-width:2px,color:#2c3e50
    style Q fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style R fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style S fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style T fill:#d5f4e6,stroke:#27ae60,stroke-width:2px,color:#2c3e50
    style U fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style V fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style W fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style X fill:#d5f4e6,stroke:#27ae60,stroke-width:2px,color:#2c3e50
    style Y fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style Z fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style AA fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style AB fill:#d5f4e6,stroke:#27ae60,stroke-width:2px,color:#2c3e50
    style AC fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style AD fill:#ebf3fd,stroke:#3498db,stroke-width:2px,color:#2c3e50
    style AE fill:#f0f3ff,stroke:#6c5ce7,stroke-width:2px,color:#2c3e50
    style AF fill:#ebdef0,stroke:#9b59b6,stroke-width:2px,color:#2c3e50

    %% Font settings - Using system fonts for compatibility